<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MASTER ADMIN - SRE Hub</title>
    <style>
        :root { --c1: 227, 0, 15; --c2: 0, 40, 85; --c3: 255, 215, 0; }
        body { background: #fdfdfd; color: #000; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; text-transform: uppercase; overflow-x: hidden; position: relative; transition: background 0.3s; }
        
        #globe-canvas { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; pointer-events: none; opacity: 0.15; }

        /* --- INTRO & AUTH SCREENS --- */
        #intro-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #ffffff; z-index: 9999999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s; color: #000;
        }
        #login-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); z-index: 9999998; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s; color: #000;
        }
        .login-box { border: 3px solid #000; padding: 40px; width: 360px; text-align: center; background: #fff; box-shadow: 0 15px 50px rgba(0,0,0,0.1); }
        .google-btn { 
            width: 100%; padding: 15px; background: #4285F4; color: white; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 14px; 
        }
        .code-input {
            width: 100%; padding: 15px; margin-bottom: 15px; border: 2px solid #000; font-size: 24px; text-align: center; letter-spacing: 10px; outline: none; font-family: monospace; background: #f9f9f9; box-sizing: border-box;
        }

        /* --- MAIN UI LAYOUT --- */
        .master-header { text-align: center; padding: 30px 0; border-bottom: 1px solid #eee; background: rgba(255,255,255,0.9); position: relative; z-index: 1; }
        .master-header img { height: 100px; margin-bottom: 10px; }
        
        .container { max-width: 1300px; margin: 0 auto; padding: 25px; position: relative; z-index: 1; display: none; } /* HIDDEN UNTIL LOGGED IN */
        .card { background: rgba(255,255,255,0.95); border: 1px solid #eee; padding: 25px; backdrop-filter: blur(5px); margin-bottom: 20px; transition: 0.2s; }
        .section-title { font-size: 11px; letter-spacing: 5px; font-weight: 900; margin: 30px 0 15px 0; border-left: 5px solid #000; padding-left: 15px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        h2 { font-size: 10px; color: #999; margin: 0 0 15px 0; letter-spacing: 2px; }

        /* --- BUTTONS & INPUTS --- */
        .btn { width: 100%; padding: 12px; margin-bottom: 8px; border: 1px solid #000; background: #fff; cursor: pointer; font-weight: bold; font-size: 11px; transition: 0.2s; }
        .btn:hover { background: #000; color: #fff; }
        .btn.black { background: #000; color: #fff; }
        .btn.red { border-color: #E3000F; color: #E3000F; }
        .btn.red:hover { background: #E3000F; color: #fff; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #eee; margin-bottom: 10px; font-size: 12px; box-sizing: border-box; outline: none; }
        .flex-row { display: flex; gap: 10px; align-items: center; }

        /* --- NETWORK TABLE --- */
        table.net-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        table.net-table th { border-bottom: 2px solid #000; padding-bottom: 10px; text-align: left; color: #888; }
        table.net-table td { padding: 12px 0; border-bottom: 1px solid #eee; }

        /* --- SOUNDCLOUD CLEAN BLACK RIM --- */
        .admin-art-wrapper { padding: 2px; border-radius: 6px; background: #000; border: 2px solid #000; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        /* --- DARK MODE --- */
        body.dark-mode { background: #0a0a0a; color: #eee; }
        body.dark-mode .master-header { background: #0a0a0a; border-bottom-color: #333; }
        body.dark-mode .card { background: #151515; border-color: #333; }
        body.dark-mode .section-title { color: #fff; border-left-color: #fff; }
        body.dark-mode input, body.dark-mode select, body.dark-mode textarea { background: #222; color: #fff; border-color: #444; }
        body.dark-mode .btn { background: #222; color: #fff; border-color: #444; }
        body.dark-mode .btn:hover { background: #eee; color: #111; }
        body.dark-mode table.net-table th { border-bottom-color: #444; }
        body.dark-mode table.net-table td { border-bottom-color: #222; }
    </style>
</head>
<body>

    <canvas id="globe-canvas"></canvas>

    <div id="intro-screen">
        <img src="logo.png" style="max-width:200px; margin-bottom:20px;" onerror="this.style.display='none'">
        <h1 style="font-size: 20px; letter-spacing: 5px; font-weight: 900;">ADMIN INITIALIZING</h1>
        <div style="border:4px solid #f3f3f3; border-top:4px solid #000; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:20px;"></div>
    </div>

    <div id="login-screen">
        <div class="login-box">
            <h1 style="font-size: 18px; letter-spacing: 4px; margin-bottom: 25px;">SYSTEM ACCESS</h1>
            
            <div id="auth-stage-1">
                <p style="font-size: 10px; margin-bottom: 20px; color: #666;">AUTHORIZE VIA GOOGLE</p>
                <button class="google-btn" onclick="signInWithGoogle()">
                    <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                    LOGIN WITH GOOGLE
                </button>
            </div>

            <div id="auth-stage-2" style="display: none;">
                <p id="user-display" style="font-size: 11px; margin-bottom: 10px; font-weight: 900; color:#E3000F;"></p>
                <input type="password" id="fallbackCode" class="code-input" maxlength="6" placeholder="******">
                <button class="btn black" style="padding:15px;" onclick="verifyFailsafeCode()">VERIFY FIREBASE CODE</button>
            </div>
        </div>
    </div>

    <div class="master-header">
        <img src="logo.png" alt="Logo" onerror="this.style.display='none'">
        <h1>SRE Master Hub Admin</h1>
    </div>

    <div class="container" id="main-ui">
        
        <div class="card" style="display:flex; justify-content: space-between; align-items: center; border: 2px solid #000;">
            <div class="flex-row">
                <span style="font-size: 11px; font-weight: 900;">ACTIVE TARGET:</span>
                <select id="target-select" style="margin:0; width: 200px;"><option value="ALL">BROADCAST TO ALL</option></select>
                <button class="btn black" style="margin:0; width:auto;" onclick="sendCommand('toggle_id')">TOGGLE IDs</button>
            </div>
            <div class="flex-row">
                <button class="btn" style="margin:0; width:auto;" onclick="document.body.classList.toggle('dark-mode')">DARK MODE</button>
                <button class="btn red" style="margin:0; width:auto;" onclick="logOut()">LOGOUT / LOCK</button>
            </div>
        </div>

        <div class="section-title">NETWORK OVERWATCH</div>
        <div class="card">
            <table class="net-table">
                <thead><tr><th>NODE ID</th><th>CONNECTION</th><th>LATENCY</th><th>STATUS</th><th>REMOTES</th></tr></thead>
                <tbody id="network-body"></tbody>
            </table>
        </div>

        <div class="section-title">MISSION CONTROL</div>
        <div class="grid">
            <div class="card" style="border-top: 5px solid #2ecc71;">
                <h2>CORE RESETS</h2>
                <button class="btn black" onclick="sendCommand('clear_media')">STOP ALL AUDIO & MEDIA</button>
                <button class="btn" onclick="sendCommand('clear_fx')">WIPE VISUAL GLITCHES</button>
                <button class="btn" onclick="sendCommand('reset_trains')">NORMALIZE TRAIN BOARD</button>
            </div>
            <div class="card" style="border-top: 5px solid #E3000F;">
                <h2>SYSTEM OVERRIDE</h2>
                <button class="btn red" onclick="sendCommand('soft_reset')">SOFT HUB REBOOT (KEEPS AUDIO)</button>
                <button class="btn red" onclick="sendCommand('reset')">HARD SYSTEM RESET</button>
                <button class="btn red" onclick="sendCommand('blackout')">FORCE TOTAL BLACKOUT</button>
            </div>
        </div>

        <div class="section-title">TRAIN DATA MANAGEMENT</div>
        <div class="card">
            <div id="train-editor"></div>
            <div class="flex-row" style="margin-top:20px;">
                <button class="btn black" style="width:auto;" onclick="addNewTrain()">+ ADD DEPARTURE</button>
                <button class="btn" style="background:#2ecc71; color:#fff; border:none; width:auto;" onclick="syncTrainBoard()">SAVE & PUSH TO HUB</button>
            </div>
        </div>

        <div class="section-title">MEDIA & HACK INJECTION</div>
        <div class="grid">
            <div class="card">
                <h2>SOUNDCLOUD CASTER</h2>
                <input type="text" id="scInput" placeholder="URL: https://soundcloud.com/...">
                <button class="btn black" onclick="castSoundCloud()">INITIALIZE STREAM</button>
                <div class="flex-row" style="margin-top:5px;">
                    <button class="btn" style="flex:1" onclick="sendCommand('sc_bg', 'topo')">TOPO</button>
                    <button class="btn" style="flex:1" onclick="sendCommand('sc_bg', 'globe')">GLOBE</button>
                    <button class="btn" style="flex:1" onclick="sendCommand('sc_bg', 'blur')">BLUR</button>
                </div>
                
                <div id="sc-admin-preview" style="display: none; margin-top: 15px; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 8px; color: white; flex-direction: column;">
                    <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                        <div class="admin-art-wrapper">
                            <img id="sc-admin-art" src="" style="width: 50px; height: 50px; border-radius: 4px; object-fit: cover; display: block;">
                        </div>
                        <div style="display: flex; flex-direction: column; overflow: hidden; flex: 1;">
                            <span style="font-size: 10px; color: #aaa; font-weight: bold; letter-spacing: 1px;">CASTING TO SCREENS</span>
                            <span id="sc-admin-title" style="font-size: 13px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 2px;">LOADING...</span>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; width: 100%;">
                        <span id="sc-time-current" style="font-size: 10px; font-family: monospace; color: #aaa;">00:00</span>
                        <input type="range" id="sc-progress" min="0" max="1" step="0.01" value="0" style="flex: 1;" onchange="seekTrack(this.value)">
                        <span id="sc-time-total" style="font-size: 10px; font-family: monospace; color: #aaa;">00:00</span>
                    </div>
                    <div class="flex-row" style="gap: 5px;">
                        <button class="btn black" style="margin:0;" onclick="sendCommand('sc_pause')">PAUSE</button>
                        <button class="btn black" style="margin:0;" onclick="sendCommand('sc_play')">PLAY</button>
                        <button class="btn black" style="margin:0;" onclick="sendCommand('sc_skip')">SKIP >></button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>AI TERMINAL & TICKER</h2>
                <textarea id="termInput" rows="3" placeholder="Terminal text..."></textarea>
                <button class="btn black" onclick="sendCommand('terminal', document.getElementById('termInput').value)">INJECT TERMINAL</button>
                <h2 style="margin-top: 15px;">NEWS TICKER OVERRIDE</h2>
                <input type="text" id="tickInput" placeholder="Ticker headline...">
                <button class="btn black" onclick="sendCommand('ticker', document.getElementById('tickInput').value)">UPDATE TICKER</button>
                <button class="btn" onclick="sendCommand('ticker', '')">RESTORE DR NEWS</button>
            </div>
            
            <div class="card">
                <h2>VISUAL CHAOS</h2>
                <div class="flex-row">
                    <button class="btn" style="flex:1" onclick="sendCommand('mirror')">MIRROR</button>
                    <button class="btn" style="flex:1" onclick="sendCommand('invert')">INVERT</button>
                </div>
                <div class="flex-row">
                    <button class="btn" style="flex:1" onclick="sendCommand('shake')">SHAKE</button>
                    <button class="btn" style="flex:1" onclick="sendCommand('disco')">DISCO</button>
                </div>
                <button class="btn black" onclick="sendCommand('scramble')">SCRAMBLE DATA</button>
                <button class="btn red" onclick="sendCommand('roblox')">ROBLOX ATTACK</button>
                <button class="btn red" onclick="sendCommand('bluescreen')">TRIGGER BSOD</button>
                
                <h2 style="margin-top:15px;">FULL SCREEN ALERTS</h2>
                <input type="text" id="mInput" placeholder="Warning Text...">
                <button class="btn red" onclick="sendCommand('msg_board', document.getElementById('mInput').value)">SEND ALERT</button>
            </div>
        </div>
        
        <div class="section-title">SYSTEM ADMINISTRATION</div>
        <div class="card">
            <h2>WEATHER OVERRIDE</h2>
            <input type="text" id="wInput" placeholder="Temp/Condition...">
            <button class="btn black" style="width: auto;" onclick="sendCommand('weather', document.getElementById('wInput').value)">SET GLOBAL WEATHER</button>
        </div>

    </div>

    <script>
        const canvas = document.getElementById('globe-canvas');
        const ctx = canvas.getContext('2d');
        let w, h, points = [], angle = 0;
        function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        const phi = Math.PI * (3 - Math.sqrt(5));
        for (let i = 0; i < 800; i++) {
            const y = 1 - (i / 799) * 2;
            const radius = Math.sqrt(1 - y * y);
            const theta = phi * i;
            points.push({ x: Math.cos(theta)*radius, y, z: Math.sin(theta)*radius, char: "X?#@&$"[i%6] });
        }
        function draw() {
            ctx.clearRect(0,0,w,h);
            ctx.font = "12px monospace"; ctx.textAlign = "center";
            angle += 0.003;
            const cosA = Math.cos(angle), sinA = Math.sin(angle);
            const projected = points.map(p => {
                const rx = p.x * cosA - p.z * sinA, rz = p.z * cosA + p.x * sinA;
                const scale = (Math.min(w,h)*0.8) / (rz + 3);
                return { x: w/2 + rx*scale, y: h/2 + p.y*scale, z: rz, char: p.char };
            }).sort((a,b) => b.z - a.z);
            
            const isDark = document.body.classList.contains('dark-mode');
            projected.forEach(p => {
                ctx.fillStyle = isDark ? `rgba(255,255,255,${(p.z+1.5)/3})` : `rgba(0,0,0,${(p.z+1.5)/3})`;
                ctx.fillText(p.char, p.x, p.y);
            });
            requestAnimationFrame(draw);
        }
        draw();
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, update, onValue, set, get, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { databaseURL: "https://trackless-controller-default-rtdb.europe-west1.firebasedatabase.app/" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const MASTER = "oliverteilgaardkoch@gmail.com";
        
        let isAuthorized = false;
        let isSeeking = false;
        let trainList = [];

        // REMOVE INTRO FAILSAFE
        setTimeout(() => {
            const intro = document.getElementById('intro-screen');
            if(intro) { intro.style.opacity = '0'; setTimeout(() => intro.style.display = 'none', 500); }
        }, 3000);

        // --- DUAL LOGIN LOGIC ---
        
        window.signInWithGoogle = () => {
            signInWithPopup(auth, provider).catch(e => {
                console.error(e);
                alert("Google Login Error. Ensure popups are allowed.");
            });
        };

        // Firebase Auth State Listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (user.email === MASTER) {
                    unlockUI(); // Oliver logs in instantly
                } else {
                    // Friend logged in: Hide Google button, ask for secret code
                    document.getElementById('auth-stage-1').style.display = 'none';
                    document.getElementById('auth-stage-2').style.display = 'block';
                    document.getElementById('user-display').innerText = "RESTRICTED ACCESS: " + user.displayName.toUpperCase();
                }
            } else {
                // Not logged in
                isAuthorized = false;
                document.getElementById('main-ui').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('login-screen').style.opacity = '1';
                document.getElementById('auth-stage-1').style.display = 'block';
                document.getElementById('auth-stage-2').style.display = 'none';
                document.getElementById('fallbackCode').value = '';
            }
        });

        // Verifies the code typed by a friend against Firebase
        window.verifyFailsafeCode = async () => {
            const input = document.getElementById('fallbackCode').value;
            try {
                const snap = await get(ref(db, 'remote/config/access_code'));
                if (snap.exists() && input === snap.val().toString()) {
                    unlockUI();
                } else {
                    alert("ACCESS DENIED: INCORRECT CODE.");
                    signOut(auth);
                }
            } catch (err) {
                console.error(err);
                alert("DATABASE ERROR: Check Firebase Rules.");
                signOut(auth);
            }
        };

        // UI UNLOCKER
        function unlockUI() {
            isAuthorized = true;
            document.getElementById('login-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-ui').style.display = 'block'; 
                startDataStreams(); 
            }, 500);
        }

        window.logOut = () => {
            signOut(auth).then(() => location.reload());
        };

        // --- COMMAND ENGINE ---
        window.sendCommand = (event, val = "", manualTarget = null) => {
            if (!isAuthorized) return;
            const target = manualTarget || document.getElementById('target-select').value;
            push(ref(db, 'remote/commands'), { event, value: val, target, ts: Date.now() });
        };

        // --- SOUNDCLOUD ---
        window.seekTrack = (value) => {
            window.sendCommand('sc_seek', value);
            setTimeout(() => { isSeeking = false; }, 1000); 
        };
        document.getElementById('sc-progress').addEventListener('mousedown', () => { isSeeking = true; });
        document.getElementById('sc-progress').addEventListener('touchstart', () => { isSeeking = true; });

        window.castSoundCloud = () => {
            const url = document.getElementById('scInput').value;
            const preview = document.getElementById('sc-admin-preview');
            if (!url) return;

            preview.style.display = 'flex';
            document.getElementById('sc-admin-title').innerText = "FETCHING TRACK...";
            document.getElementById('sc-admin-art').src = "";
            
            fetch(`https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(url)}`)
                .then(res => res.json())
                .then(data => {
                    let artUrl = data.thumbnail_url ? data.thumbnail_url.replace('large', 't500x500') : '';
                    document.getElementById('sc-admin-art').src = artUrl;
                    document.getElementById('sc-admin-title').innerText = data.title.toUpperCase();

                    const payload = { url, title: data.title, art: artUrl };
                    window.sendCommand('soundcloud', JSON.stringify(payload));
                }).catch(() => {
                    document.getElementById('sc-admin-title').innerText = "UNKNOWN TRACK";
                });
        };

        // --- DATA STREAMS (Only runs after login) ---
        function startDataStreams() {
            
            // 1. Fetch Trains
            get(ref(db, 'remote/trains')).then(s => {
                trainList = s.exists() ? s.val() : [
                    { time: "09:30", type: "IC", dest: "KÃ˜BENHAVN H", track: "4", status: "TIL TIDEN", color: "white", blink: false }
                ];
                renderTrainEditor();
            });

            // 2. Media Tracking
            function formatTime(ms) {
                let s = Math.floor(ms / 1000); let m = Math.floor(s / 60); s = s % 60;
                return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            }
            onValue(ref(db, 'remote/media_state'), (snapshot) => {
                if (snapshot.exists()) {
                    const state = snapshot.val();
                    if (state.totalTime > 0) {
                        document.getElementById('sc-time-total').innerText = formatTime(state.totalTime);
                        document.getElementById('sc-time-current').innerText = formatTime(state.currentTime);
                        if (!isSeeking) { document.getElementById('sc-progress').value = (state.currentTime / state.totalTime); }
                    }
                }
            });

            // 3. Network Monitor
            onValue(ref(db, 'remote/screens'), (s) => {
                const nodes = s.val() || {};
                const tbody = document.getElementById('network-body');
                const select = document.getElementById('target-select');
                const now = Date.now();
                const currentTarget = select.value;
                
                select.innerHTML = '<option value="ALL">BROADCAST TO ALL</option>';
                tbody.innerHTML = Object.keys(nodes).map(id => {
                    const ping = now - nodes[id].heartbeat;
                    const online = ping < 10000;
                    if(online) select.innerHTML += `<option value="${id}">${id}</option>`;
                    return `
                        <tr>
                            <td><strong>${id}</strong></td>
                            <td><span style="color:${online?'#2ecc71':'#E3000F'}; font-weight:bold;">${online?'STABLE':'LOST'}</span></td>
                            <td>${online ? ping + 'ms' : '--'}</td>
                            <td>ACTIVE</td>
                            <td><button class="btn red" style="margin:0; padding:2px 10px; width:auto;" onclick="sendCommand('kick', '', '${id}')">KICK</button></td>
                        </tr>
                    `;
                }).join('');

                if (Array.from(select.options).some(o => o.value === currentTarget)) { select.value = currentTarget; }
            });
        }

        // --- TRAIN MGMT FUNCTIONS ---
        window.renderTrainEditor = () => {
            const el = document.getElementById('train-editor');
            el.innerHTML = trainList.map((t, i) => `
                <div class="flex-row" style="margin-bottom:8px;">
                    <input type="text" id="t-time-${i}" value="${t.time}" style="flex:0.6" placeholder="00:00">
                    <input type="text" id="t-type-${i}" value="${t.type}" style="flex:0.8" placeholder="Type">
                    <input type="text" id="t-dest-${i}" value="${t.dest}" style="flex:2" placeholder="Destination">
                    <input type="text" id="t-track-${i}" value="${t.track}" style="flex:0.5" placeholder="Sp">
                    <input type="text" id="t-stat-${i}" value="${t.status}" style="flex:1" placeholder="Status">
                    <select id="t-col-${i}" style="flex:1">
                        <option value="white" ${t.color==='white'?'selected':''}>WHITE</option>
                        <option value="red" ${t.color==='red'?'selected':''}>RED</option>
                        <option value="yellow" ${t.color==='yellow'?'selected':''}>YELLOW</option>
                        <option value="green" ${t.color==='green'?'selected':''}>GREEN</option>
                    </select>
                    <label style="flex:0.5; font-size:10px;"><input type="checkbox" id="t-blk-${i}" ${t.blink?'checked':''}> BLINK</label>
                    <button class="btn red" style="width:auto; margin:0; padding:10px;" onclick="removeTrain(${i})">X</button>
                </div>
            `).join('');
        };

        window.addNewTrain = () => {
            trainList.push({ time: "00:00", type: "RE", dest: "DESTINATION", track: "1", status: "TIL TIDEN", color: "white", blink: false });
            renderTrainEditor();
        };

        window.removeTrain = (i) => {
            trainList.splice(i, 1);
            renderTrainEditor();
        };

        window.syncTrainBoard = () => {
            trainList.forEach((t, i) => {
                t.time = document.getElementById(`t-time-${i}`).value;
                t.type = document.getElementById(`t-type-${i}`).value;
                t.dest = document.getElementById(`t-dest-${i}`).value;
                t.track = document.getElementById(`t-track-${i}`).value;
                t.status = document.getElementById(`t-stat-${i}`).value;
                t.color = document.getElementById(`t-col-${i}`).value;
                t.blink = document.getElementById(`t-blk-${i}`).checked;
            });
            set(ref(db, 'remote/trains'), trainList);
            alert("BOARD SYNCHRONIZED.");
        };
    </script>
</body>
</html>