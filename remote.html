<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MASTER ADMIN - OLIVER TECH</title>
    <style>
        body { background: #fdfdfd; color: #000; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; text-transform: uppercase; overflow-x: hidden; }
        
        /* --- CLEAN WHITE INTRO (MATCHES PROJECTOR) --- */
        #intro-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #ffffff; z-index: 9999999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            transition: opacity 1s ease-in-out; color: #000;
        }
        #intro-screen img { max-width: 200px; margin-bottom: 30px; }
        #intro-screen h1 { font-size: 20px; letter-spacing: 5px; margin: 0; font-weight: 900; }
        #intro-loader {
            border: 4px solid #f3f3f3; border-top: 4px solid #000;
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 20px 0;
        }
        #load-status { font-family: monospace; font-size: 12px; color: #666; text-transform: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- LOGIN SCREEN --- */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; z-index: 999999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-box { border: 2px solid #000; padding: 40px; width: 320px; text-align: center; background: #fff; }
        .login-box h1 { font-size: 18px; margin-bottom: 25px; letter-spacing: 3px; }
        .login-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; outline: none; font-size: 14px; }
        .login-btn { width: 100%; padding: 12px; background: #000; color: #fff; border: none; font-weight: bold; cursor: pointer; }

        /* --- HEADER & LOGO --- */
        .master-header { text-align: center; padding: 40px 0; border-bottom: 1px solid #eee; background: #fff; }
        .master-header img { height: 120px; margin-bottom: 10px; }
        .master-header h1 { font-size: 14px; letter-spacing: 10px; margin: 0; color: #000; }

        /* --- MAIN UI --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 25px; }
        .target-box { background: #fff; border: 1px solid #000; padding: 20px; margin-bottom: 25px; display: flex; align-items: center; justify-content: center; gap: 20px; }
        select { padding: 10px; font-weight: bold; border: 1px solid #000; cursor: pointer; }

        .section-title { font-size: 12px; letter-spacing: 4px; font-weight: 900; margin: 40px 0 20px 0; border-left: 5px solid #000; padding-left: 15px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .card { background: #fff; border: 1px solid #eee; padding: 25px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .card:hover { border-color: #000; }
        h2 { font-size: 10px; color: #999; margin: 0 0 15px 0; letter-spacing: 2px; }

        .btn { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #000; background: #fff; color: #000; font-weight: bold; cursor: pointer; font-size: 11px; transition: 0.2s; }
        .btn:hover { background: #000; color: #fff; }
        .btn.black { background: #000; color: #fff; }
        .btn.red { border-color: #E3000F; color: #E3000F; }
        .btn.red:hover { background: #E3000F; color: #fff; }

        input, textarea { width: 100%; padding: 10px; border: 1px solid #eee; margin-bottom: 10px; box-sizing: border-box; font-family: sans-serif; font-size: 12px; outline: none; }
        input:focus { border-color: #000; }
        
        .flex-row { display: flex; gap: 10px; }
    </style>
</head>
<body>

    <div id="intro-screen">
        <img src="logo.png" alt="Logo" onerror="this.style.display='none'">
        <h1>ADMIN INITIALIZING</h1>
        <div id="intro-loader"></div>
        <div id="load-status">Connecting to servers...</div>
        <div style="margin-top: 20px; font-size: 10px; letter-spacing: 2px;">OLIVER TECH HUB v4.0</div>
    </div>

    <div id="login-screen">
        <div class="login-box">
            <img src="logo.png" style="height: 50px; margin-bottom: 20px;" onerror="this.style.display='none'">
            <h1>SYSTEM ACCESS</h1>
            <input type="text" id="logUser" placeholder="USERNAME">
            <input type="password" id="logPass" placeholder="PASSWORD">
            <button class="login-btn" onclick="checkLogin()">AUTHENTICATE</button>
        </div>
    </div>

    <div class="master-header">
        <img src="logo.png" alt="Logo" onerror="this.style.display='none'">
        <h1>OLIVER TECH</h1>
    </div>

    <div class="container">
        <div class="target-box">
            <span>COMMAND TARGET:</span>
            <select id="target-screen"><option value="ALL">ALL ACTIVE SCREENS</option></select>
            <button class="btn black" style="width:auto; margin:0;" onclick="sendCommand('toggle_id')">TOGGLE ID TAGS</button>
        </div>

        <div class="section-title">DSB TRAIN BOARD</div>
        <div class="grid">
            <div class="card">
                <h2>CORE BROADCAST</h2>
                <input type="text" id="tInput" placeholder="Force Headline to News Ticker...">
                <button class="btn" onclick="sendCommand('ticker', document.getElementById('tInput').value)">UPDATE TICKER</button>
                <button class="btn red" onclick="sendCommand('status', 'PREMIERE NU')">SET LIVE STATUS</button>
            </div>
            
            <div class="card">
                <h2>TRAIN STATUS</h2>
                <div class="flex-row">
                    <input type="number" id="dInput" placeholder="Min" style="flex:1">
                    <button class="btn" style="flex:2" onclick="sendCommand('delay', document.getElementById('dInput').value)">DELAY ALL</button>
                </div>
                <button class="btn" onclick="sendCommand('boarding')">SET TO BOARDING</button>
                <button class="btn" onclick="sendCommand('reset_trains')">RESET TO "TIL TIDEN"</button>
            </div>

            <div class="card">
                <h2>EMERGENCY ALERTS</h2>
                <textarea id="mInput" rows="2" placeholder="Full screen alert text..."></textarea>
                <button class="btn red" onclick="sendCommand('msg_board', document.getElementById('mInput').value)">SEND FULL SCREEN ALERT</button>
            </div>
        </div>

        <div class="section-title">THE MESS AROUND HACKS</div>
        <div class="grid">
            <div class="card">
                <h2>AI TERMINAL</h2>
                <textarea id="termInput" rows="3" placeholder="Type AI message..."></textarea>
                <button class="btn black" onclick="sendTerminal()">INJECT TERMINAL DATA</button>
                <button class="btn" style="margin-top:10px" onclick="sendCommand('dvd')">ACTIVATE DVD BOUNCE</button>
            </div>

            <div class="card">
                <h2>VISUAL CHAOS</h2>
                <div class="flex-row">
                    <button class="btn" onclick="sendCommand('mirror')">MIRROR</button>
                    <button class="btn" onclick="sendCommand('invert')">INVERT</button>
                </div>
                <div class="flex-row">
                    <button class="btn" onclick="sendCommand('shake')">SHAKE</button>
                    <button class="btn" onclick="sendCommand('disco')">DISCO</button>
                </div>
                <button class="btn" onclick="sendCommand('scramble')">MATRIX SCRAMBLE</button>
                <button class="btn" onclick="sendCommand('deepfried')">DEEP FRIED MODE</button>
            </div>

            <div class="card">
                <h2>SYSTEM FAILURES</h2>
                <button class="btn red" onclick="sendCommand('bluescreen')">BSOD (BLUE SCREEN)</button>
                <button class="btn red" onclick="sendCommand('winupdate')">FORCE WIN UPDATE</button>
                <button class="btn black" onclick="sendCommand('blackout')">BLACKOUT SCREEN</button>
                <button class="btn red" style="margin-top:15px;" onclick="sendCommand('reset')">HARD SYSTEM RESTART</button>
            </div>
        </div>

        <div class="section-title">SYSTEM ADMINISTRATION</div>
        <div class="grid">
            <div class="card">
                <h2>USER MANAGEMENT</h2>
                <input type="text" id="newU" placeholder="New Username">
                <input type="password" id="newP" placeholder="New Password">
                <button class="btn" onclick="addUser()">CREATE ADMIN</button>
            </div>
            <div class="card">
                <h2>GLOBAL RESET</h2>
                <button class="btn black" onclick="sendCommand('clear_media')">CLEAR ALL OVERLAYS</button>
                <button class="btn black" onclick="sendCommand('clear_fx')">CLEAR ALL VISUAL FX</button>
            </div>
            <div class="card">
                <h2>WEATHER OVERRIDE</h2>
                <input type="text" id="wInput" placeholder="e.g. 999Â°C FIRE STORM">
                <button class="btn" onclick="sendCommand('weather', document.getElementById('wInput').value)">SET GLOBAL WEATHER</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, update, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- INTRO LOGIC ---
        const introMessages = ["Authenticating Oliver-Tech Admin...", "Connecting to Projector Hub...", "Syncing Database...", "Opening Encrypted Link...", "Welcome."];
        let introIdx = 0;
        const statusEl = document.getElementById('load-status');
        const introInterval = setInterval(() => {
            if(introIdx < introMessages.length) {
                statusEl.innerText = introMessages[introIdx];
                introIdx++;
            } else { clearInterval(introInterval); }
        }, 700);

        setTimeout(() => {
            const intro = document.getElementById('intro-screen');
            intro.style.opacity = '0';
            setTimeout(() => intro.style.display = 'none', 1000); 
        }, 4000);

        // --- FIREBASE CORE ---
        const firebaseConfig = { databaseURL: "https://trackless-controller-default-rtdb.europe-west1.firebasedatabase.app/" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- AUTH ---
        let usersDB = { admin: "1234" };
        onValue(ref(db, 'remote/users'), (snap) => {
            if(snap.val()) usersDB = snap.val();
        });

        window.checkLogin = () => {
            const u = document.getElementById('logUser').value;
            const p = document.getElementById('logPass').value;
            if (usersDB[u] === p) document.getElementById('login-screen').style.display = 'none';
            else alert("ACCESS DENIED");
        };

        window.addUser = () => {
            const u = document.getElementById('newU').value;
            const p = document.getElementById('newP').value;
            if (u && p) {
                update(ref(db, 'remote/users'), { [u]: p });
                alert("USER " + u + " ADDED");
            }
        };

        // --- COMMANDS ---
        window.sendCommand = (event, val = "") => {
            const target = document.getElementById('target-screen').value;
            update(ref(db, 'remote/commands'), {
                event: event,
                value: val,
                target: target,
                ts: Date.now()
            });
        };

        window.sendTerminal = () => {
            const txt = document.getElementById('termInput').value;
            window.sendCommand('terminal', txt || "> SYSTEM OVERRIDE...");
            document.getElementById('termInput').value = "";
        };

        // --- SCREEN DETECTION ---
        onValue(ref(db, 'remote/screens'), (snapshot) => {
            const screens = snapshot.val();
            const select = document.getElementById('target-screen');
            const current = select.value;
            select.innerHTML = '<option value="ALL">ALL SCREENS</option>';
            if (screens) {
                Object.keys(screens).forEach(id => {
                    if (Date.now() - screens[id].heartbeat < 10000) {
                        const opt = document.createElement('option');
                        opt.value = id; opt.innerText = id; select.appendChild(opt);
                    }
                });
            }
            select.value = current;
        });
    </script>
</body>
</html>