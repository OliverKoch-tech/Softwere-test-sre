<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>DSB Master Hub - Øster Kippinge</title>
    <style>
        body { background: #050505; color: white; font-family: Arial, sans-serif; text-transform: uppercase; margin: 0; padding: 20px; overflow: hidden; height: 100vh; transition: 0.5s; }
        
        /* THE TROLL CSS */
        .mirror { transform: scaleX(-1); }
        .glitch-red { animation: panic 0.1s infinite; }
        @keyframes panic { 0% { background: #050505; } 50% { background: #400; } }
        
        .header { display: flex; justify-content: space-between; border-bottom: 5px solid #E3000F; padding-bottom: 15px; }
        .time { color: #FFD700; font-size: 50px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        td { padding: 12px 0; border-bottom: 1px solid #1a1a1a; font-size: 28px; font-weight: bold; }
        .yellow { color: #FFD700; } .red { color: #ff3333; } .white { color: #ffffff; }
        .blinking { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* OVERLAYS */
        #blackout { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9998; display: none; }
        #jumpscare { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; display: none; background-size: contain; background-repeat: no-repeat; background-position: center; }
        #error-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0000aa; color: white; z-index: 10000; display: none; padding: 50px; font-family: monospace; text-transform: none; }

        .ticker-container { position: fixed; bottom: 0; left: 0; width: 100%; background-color: #002855; color: white; padding: 15px 0; font-size: 24px; font-weight: bold; white-space: nowrap; border-top: 2px solid #ffffff33; }
        .ticker-text { display: inline-block; padding-left: 100%; animation: ticker 45s linear infinite; }
        @keyframes ticker { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        .footer-logo { position: fixed; bottom: 70px; left: 20px; height: 25px; opacity: 0.2; filter: grayscale(100%) drop-shadow(0 0 1px white); }
    </style>
</head>
<body id="main-body">
    <div id="blackout"></div>
    <div id="jumpscare"></div>
    <div id="error-overlay"><h1>:(</h1><p>Your PC ran into a problem and needs to restart. We're just collecting some error info, and then we'll restart for you.</p><p>0% complete</p></div>

    <div class="header">
        <div style="font-size: 45px; font-weight: 900;">AFGANGE</div>
        <div style="text-align: right;">
            <div class="time" id="clock">00:00:00</div>
            <div id="date-row" style="font-size: 18px; font-weight: bold;">--</div>
            <div id="weather" style="color: #aaa; font-size: 16px;">ØSTER KIPPINGE: --°C</div>
        </div>
    </div>

    <table>
        <thead><tr><th>TID</th><th>TOG</th><th>DESTINATION</th><th>SPOR</th><th>BEMÆRKNING</th></tr></thead>
        <tbody id="train-table">
            <tr><td class="yellow">09:30</td><td><span style="background:#E3000F; color:white; padding:2px 8px;">IC</span></td><td class="white">KØBENHAVN H</td><td class="yellow">4</td><td class="white status-msg">TIL TIDEN</td></tr>
            <tr style="background: rgba(227, 0, 15, 0.15);"><td class="yellow blinking">11:00</td><td><span style="background:#E3000F; color:white; padding:2px 8px;">SPIL</span></td><td class="yellow">SPORLØS</td><td class="yellow">1</td><td class="red blinking" id="play-status">KLAR</td></tr>
            <tr><td class="yellow">13:00</td><td><span style="background:#002855; color:white; padding:2px 8px;">RE</span></td><td class="white">HJEMBY</td><td class="yellow">1</td><td class="white status-msg">KLAR</td></tr>
        </tbody>
    </table>

    <img src="logo.png" class="footer-logo">
    <div class="ticker-container"><div class="ticker-text" id="ticker-msg">SYNCER...</div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://trackless-controller-default-rtdb.europe-west1.firebasedatabase.app/" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- DEBUG HEARTBEAT (So the Admin PC knows you are online) ---
        setInterval(() => { set(ref(db, 'remote/heartbeat'), Date.now()); }, 2000);

        onValue(ref(db, 'remote/'), (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            // 1. MASTER RESET (Clears everything)
            if (data.event === "reset") { location.reload(); return; }

            // 2. TEXT UPDATES
            if (data.status) document.getElementById('play-status').innerText = data.status;
            if (data.ticker) document.getElementById('ticker-msg').innerText = "*** " + data.ticker.toUpperCase() + " ***";

            // 3. JUMPSCARES
            if (data.event === "roblox") triggerImg('roblox.jpg');
            if (data.event === "meme") triggerImg('meme.jpg');

            // 4. CHAOS EVENTS
            const body = document.getElementById('main-body');
            if (data.event === "blackout") { 
                document.getElementById('blackout').style.display = 'block';
                setTimeout(() => document.getElementById('blackout').style.display = 'none', 20000);
            }
            if (data.event === "mirror") body.classList.toggle('mirror');
            if (data.event === "panic") body.classList.add('glitch-red');
            if (data.event === "bluescreen") document.getElementById('error-overlay').style.display = 'block';
            
            if (data.event === "delay") {
                document.querySelectorAll('.status-msg').forEach(el => {
                    el.innerText = "FORSINKET 99 MIN"; el.className = "red blinking";
                });
            }
        });

        function triggerImg(img) {
            const el = document.getElementById('jumpscare');
            el.style.backgroundImage = `url('${img}')`;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        // Clock, Weather & Date
        function updateTime() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('da-DK');
            document.getElementById('date-row').innerText = now.toLocaleDateString('da-DK', {weekday:'long', day:'numeric', month:'short'}).toUpperCase();
        }
        setInterval(updateTime, 1000); updateTime();

        async function fetchWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=54.91&longitude=11.85&current_weather=true');
                const d = await res.json();
                document.getElementById('weather').innerText = `ØSTER KIPPINGE: ${Math.round(d.current_weather.temperature)}°C SKYET`;
            } catch(e) {}
        }
        fetchWeather();
    </script>
</body>
</html>